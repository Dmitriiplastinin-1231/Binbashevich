<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–Ω–∏–≥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #1e293b;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid #334155;
        }

        header {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .forms-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-section {
            background: #0f172a;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #334155;
        }

        .form-section h2 {
            color: #a5b4fc;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #cbd5e1;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #334155;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s, background-color 0.3s;
            background: #1e293b;
            color: #e2e8f0;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #6366f1;
            background: #0f172a;
        }

        .hint {
            font-size: 0.9em;
            color: #94a3b8;
            margin-top: 5px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.5);
        }

        .btn-secondary {
            background: #475569;
            color: white;
        }

        .btn-secondary:hover {
            background: #334155;
        }

        .results-section {
            margin-top: 30px;
            display: none;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-header h2 {
            color: #a5b4fc;
            font-size: 1.5em;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
        }

        .book-card {
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .book-card:hover {
            border-color: #6366f1;
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .book-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .book-title {
            font-size: 1.4em;
            color: #f1f5f9;
            font-weight: 700;
            flex: 1;
        }

        .book-score {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9em;
        }

        .book-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .book-meta-item {
            font-size: 0.95em;
            color: #94a3b8;
        }

        .book-meta-item strong {
            color: #cbd5e1;
        }

        .book-description {
            color: #94a3b8;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .book-keywords {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .keyword-tag {
            background: #334155;
            color: #a5b4fc;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            border: 1px solid #475569;
        }

        .book-checkbox {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .book-checkbox input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #6366f1;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .book-checkbox input[type="checkbox"]:hover {
            transform: scale(1.1);
        }

        .book-checkbox input[type="checkbox"]:checked {
            filter: brightness(1.2);
        }

        .book-checkbox label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }

        .selected-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .selection-panel {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .selection-panel.active {
            display: flex;
        }

        .selection-panel-info {
            color: white;
            font-size: 1.1em;
            font-weight: 600;
        }

        .selection-panel button {
            background: white;
            color: #6366f1;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .selection-panel button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
        }

        .reading-list-section {
            margin-top: 30px;
            display: none;
            background: #0f172a;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #334155;
        }

        .reading-list-section.active {
            display: block;
        }

        .reading-list-section h2 {
            color: #a5b4fc;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .reading-list-item {
            background: #1e293b;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #334155;
        }

        .reading-list-item-info h4 {
            color: #f1f5f9;
            margin-bottom: 5px;
        }

        .reading-list-item-info p {
            color: #94a3b8;
            font-size: 0.9em;
        }

        .reading-list-item button {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .reading-list-item button:hover {
            background: #dc2626;
        }

        .empty-list {
            text-align: center;
            padding: 20px;
            color: #94a3b8;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #a5b4fc;
            display: none;
        }

        .error-message {
            background: #7f1d1d;
            color: #fecaca;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border: 1px solid #991b1b;
        }

        .info-message {
            background: #164e63;
            color: #a5f3fc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #0e7490;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        @media (max-width: 968px) {
            .forms-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .results-header {
                flex-direction: column;
                align-items: stretch;
            }

            .export-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–Ω–∏–≥</h1>
            <p>–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ—é —Å–ª–µ–¥—É—é—â—É—é –ª—é–±–∏–º—É—é –∫–Ω–∏–≥—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π</p>
        </header>

        <div class="content">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalBooks">{{ total_books }}</div>
                    <div class="stat-label">–ö–Ω–∏–≥ –≤ –±–∞–∑–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ genres|length }}</div>
                    <div class="stat-label">–ñ–∞–Ω—Ä–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ authors|length }}</div>
                    <div class="stat-label">–ê–≤—Ç–æ—Ä–æ–≤</div>
                </div>
            </div>

            <div class="forms-container">
                <div class="form-section">
                    <h2>üéØ –£–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</h2>
                    
                    <div class="form-group">
                        <label for="genres">–õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã</label>
                        <input type="text" id="genres" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –¥–µ—Ç–µ–∫—Ç–∏–≤, –∫–ª–∞—Å—Å–∏–∫–∞">
                        <div class="hint">–í–≤–µ–¥–∏—Ç–µ –∂–∞–Ω—Ä—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</div>
                    </div>

                    <div class="form-group">
                        <label for="authors">–õ—é–±–∏–º—ã–µ –∞–≤—Ç–æ—Ä—ã</label>
                        <input type="text" id="authors" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–π–∑–µ–∫ –ê–∑–∏–º–æ–≤, –ê–≥–∞—Ç–∞ –ö—Ä–∏—Å—Ç–∏">
                        <div class="hint">–í–≤–µ–¥–∏—Ç–µ –∞–≤—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</div>
                    </div>

                    <div class="form-group">
                        <label for="keywords">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (—Ç–µ–º—ã, –∏–Ω—Ç–µ—Ä–µ—Å—ã)</label>
                        <input type="text" id="keywords" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç, —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, –∫–æ—Å–º–æ—Å">
                        <div class="hint">–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>üîç –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h2>
                    
                    <div class="form-group">
                        <label for="minYear">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≥–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (–æ—Å—Ç–∞–≤—å—Ç–µ 0 –¥–ª—è –≤—Å–µ—Ö)</label>
                        <input type="number" id="minYear" value="0" min="0" max="{{ year_max }}">
                    </div>

                    <div class="form-group">
                        <label for="sortBy">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ</label>
                        <select id="sortBy">
                            <option value="score">–†–µ–π—Ç–∏–Ω–≥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è</option>
                            <option value="title">–ê–ª—Ñ–∞–≤–∏—Ç (–Ω–∞–∑–≤–∞–Ω–∏–µ)</option>
                            <option value="year">–ì–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="limit">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö)</label>
                        <input type="number" id="limit" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 10" min="1">
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="getRecommendations()">
                    üîç –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                </button>
                <button class="btn-secondary" onclick="resetForm()">
                    üîÑ –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
                </button>
            </div>

            <div class="error-message" id="errorMessage"></div>
            <div class="loading" id="loading">‚è≥ –ü–æ–¥–±–∏—Ä–∞–µ–º –∫–Ω–∏–≥–∏ –¥–ª—è –≤–∞—Å...</div>

            <div class="results-section" id="resultsSection">
                <div class="results-header">
                    <div>
                        <h2>üìñ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤–∞—Å</h2>
                        <p id="preferencesSummary" style="color: #94a3b8; margin-top: 5px;"></p>
                        <p id="resultsCount" style="color: #94a3b8; margin-top: 5px;"></p>
                    </div>
                    <div class="export-buttons">
                        <button class="btn-primary" onclick="exportResults('json')">
                            üíæ –≠–∫—Å–ø–æ—Ä—Ç JSON
                        </button>
                        <button class="btn-primary" onclick="exportResults('csv')">
                            üìä –≠–∫—Å–ø–æ—Ä—Ç CSV
                        </button>
                    </div>
                </div>
                
                <div class="selection-panel" id="selectionPanel">
                    <div class="selection-panel-info" id="selectionInfo">–í—ã–±—Ä–∞–Ω–æ –∫–Ω–∏–≥: 0</div>
                    <button onclick="addSelectedToReadingList()" id="addToListBtn">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—á–∏—Ç–∞—Ç—å
                    </button>
                </div>
                
                <div id="results"></div>
            </div>

            <div class="reading-list-section" id="readingListSection">
                <h2>üìö –ú–æ–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—á–∏—Ç–∞—Ç—å</h2>
                <div id="readingList"></div>
            </div>
        </div>
    </div>

    <script>
        let currentRecommendations = [];

        async function getRecommendations() {
            const genres = document.getElementById('genres').value;
            const authors = document.getElementById('authors').value;
            const keywords = document.getElementById('keywords').value;
            const minYear = document.getElementById('minYear').value;
            const sortBy = document.getElementById('sortBy').value;
            const limit = document.getElementById('limit').value;

            // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É - –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –±–µ–∑ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

            hideError();
            showLoading();
            hideResults();

            try {
                const response = await fetch('/api/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        genres: genres,
                        authors: authors,
                        keywords: keywords,
                        min_year: minYear || 0,
                        sort_by: sortBy,
                        limit: limit || null
                    })
                });

                const data = await response.json();

                if (data.success) {
                    currentRecommendations = data.recommendations;
                    displayResults(data);
                } else {
                    showError(data.error || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π');
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            const preferencesSummary = document.getElementById('preferencesSummary');
            const resultsCount = document.getElementById('resultsCount');

            preferencesSummary.textContent = data.preferences_summary;
            resultsCount.textContent = `–ù–∞–π–¥–µ–Ω–æ –∫–Ω–∏–≥: ${data.count}`;

            if (data.recommendations.length === 0) {
                resultsDiv.innerHTML = '<div class="info-message">–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ –≤–∞—à–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞.</div>';
            } else {
                resultsDiv.innerHTML = data.recommendations.map((book, index) => `
                    <div class="book-card">
                        <div class="book-checkbox">
                            <input type="checkbox" id="book-${index}" value="${index}" onchange="updateSelectedCount()">
                            <label for="book-${index}">
                                <div class="book-header" style="margin: 0; display: flex; justify-content: space-between; align-items: start; width: 100%;">
                                    <div class="book-title" style="margin: 0;">${book.title}</div>
                                    <div class="book-score">‚≠ê ${book.match_score}</div>
                                </div>
                            </label>
                        </div>
                        <div class="book-meta">
                            <div class="book-meta-item"><strong>–ê–≤—Ç–æ—Ä:</strong> ${book.author}</div>
                            <div class="book-meta-item"><strong>–ñ–∞–Ω—Ä:</strong> ${book.genre}</div>
                            <div class="book-meta-item"><strong>–ì–æ–¥:</strong> ${book.year}</div>
                        </div>
                        <div class="book-description">${book.description}</div>
                        ${book.keywords && book.keywords.length > 0 ? `
                            <div class="book-keywords">
                                ${book.keywords.map(kw => `<span class="keyword-tag">${kw}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            }

            showSelectedActions();

            document.getElementById('resultsSection').style.display = 'block';
        }

        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('#results .book-checkbox input[type="checkbox"]:checked');
            const count = checkboxes.length;
            
            const selectionPanel = document.getElementById('selectionPanel');
            const selectionInfo = document.getElementById('selectionInfo');
            const addToListBtn = document.getElementById('addToListBtn');
            
            if (count > 0) {
                selectionInfo.textContent = `–í—ã–±—Ä–∞–Ω–æ –∫–Ω–∏–≥: ${count}`;
                addToListBtn.textContent = `‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—á–∏—Ç–∞—Ç—å (${count})`;
                selectionPanel.classList.add('active');
            } else {
                selectionPanel.classList.remove('active');
            }
        }

        function showSelectedActions() {
            // –ü–∞–Ω–µ–ª—å —É–∂–µ –≤ HTML, –ø—Ä–æ—Å—Ç–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –µ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            const selectionPanel = document.getElementById('selectionPanel');
            if (selectionPanel) {
                selectionPanel.classList.remove('active');
            }
        }

        function addSelectedToReadingList() {
            const checkboxes = document.querySelectorAll('#results .book-checkbox input[type="checkbox"]:checked');
            const selectedIndices = Array.from(checkboxes).map(cb => parseInt(cb.value));
            
            const readingList = getReadingList();
            
            selectedIndices.forEach(index => {
                const book = currentRecommendations[index];
                const bookId = `${book.title}-${book.author}`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –∫–Ω–∏–≥–∏ –≤ —Å–ø–∏—Å–∫–µ
                if (!readingList.find(item => item.id === bookId)) {
                    readingList.push({
                        id: bookId,
                        title: book.title,
                        author: book.author,
                        genre: book.genre,
                        year: book.year,
                        addedAt: new Date().toISOString()
                    });
                }
            });
            
            saveReadingList(readingList);
            displayReadingList(readingList);
            
            // –û—á–∏—â–∞–µ–º –≤—ã–±–æ—Ä
            checkboxes.forEach(cb => cb.checked = false);
            updateSelectedCount();
            
            showError('–ö–Ω–∏–≥–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—á–∏—Ç–∞—Ç—å! ‚ú®', 'success');
        }

        function getReadingList() {
            const stored = localStorage.getItem('readingList');
            return stored ? JSON.parse(stored) : [];
        }

        function saveReadingList(list) {
            localStorage.setItem('readingList', JSON.stringify(list));
        }

        function displayReadingList(list) {
            const readingListSection = document.getElementById('readingListSection');
            const readingListDiv = document.getElementById('readingList');
            
            if (list.length === 0) {
                readingListSection.classList.remove('active');
                return;
            }
            
            readingListSection.classList.add('active');
            
            readingListDiv.innerHTML = list.map(book => `
                <div class="reading-list-item">
                    <div class="reading-list-item-info">
                        <h4>${book.title}</h4>
                        <p><strong>${book.author}</strong> ‚Ä¢ ${book.genre} ‚Ä¢ ${book.year}</p>
                    </div>
                    <button onclick="removeFromReadingList('${book.id.replace(/'/g, "\\'")}')">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            `).join('');
        }

        function removeFromReadingList(bookId) {
            let list = getReadingList();
            list = list.filter(item => item.id !== bookId);
            saveReadingList(list);
            displayReadingList(list);
            showError('–ö–Ω–∏–≥–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç—å', 'info');
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            const readingList = getReadingList();
            displayReadingList(readingList);
        });

        async function exportResults(format) {
            if (currentRecommendations.length === 0) {
                showError('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                return;
            }

            try {
                const response = await fetch('/api/export', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        recommendations: currentRecommendations,
                        format: format
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
                    window.location.href = `/api/download/${data.filename}`;
                } else {
                    showError(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ');
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ: ' + error.message);
            }
        }

        function resetForm() {
            document.getElementById('genres').value = '';
            document.getElementById('authors').value = '';
            document.getElementById('keywords').value = '';
            document.getElementById('minYear').value = '0';
            document.getElementById('sortBy').value = 'score';
            document.getElementById('limit').value = '';
            hideResults();
            hideError();
            currentRecommendations = [];
        }

        function showError(message, type = 'error') {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            
            if (type === 'success') {
                errorDiv.style.background = '#065f46';
                errorDiv.style.color = '#86efac';
                errorDiv.style.borderColor = '#059669';
            } else if (type === 'info') {
                errorDiv.style.background = '#164e63';
                errorDiv.style.color = '#a5f3fc';
                errorDiv.style.borderColor = '#0e7490';
            } else {
                errorDiv.style.background = '#7f1d1d';
                errorDiv.style.color = '#fecaca';
                errorDiv.style.borderColor = '#991b1b';
            }
            
            errorDiv.style.display = 'block';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            if (type !== 'error') {
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function hideResults() {
            document.getElementById('resultsSection').style.display = 'none';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    getRecommendations();
                }
            });
        });
    </script>
</body>
</html>
